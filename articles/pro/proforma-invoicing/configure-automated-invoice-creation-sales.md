---
title: 設定自動發票建立作業 - 精簡
description: 本主題提供有關設定預估發票自動建立作業的資訊。
author: rumant
manager: Annbe
ms.date: 10/13/2020
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: rumant
ms.openlocfilehash: 1d911ab0defaaee40d8752557e1115ea49c8fa93
ms.sourcegitcommit: fa32b1893286f20271fa4ec4be8fc68bd135f53c
ms.translationtype: HT
ms.contentlocale: zh-HK
ms.lasthandoff: 02/15/2021
ms.locfileid: "5274350"
---
# <a name="configure-automatic-invoice-creation---lite"></a>設定自動發票建立作業 - 精簡
 
_**適用於：** 精簡部署 - 交易至開立預估發票_

您可以在 Dynamics 365 Project Operations 中設定自動發票建立作業。 系統會根據每個專案合約和合約服務內容的發票排程，建立草稿預估發票。 發票排程是在合約服務內容層級進行設定。 合約的每個服務內容都可以有不同的發票排程，或者相同的發票排程可以包含在合約的所有服務內容。

建立發票時，系統一律每個專案合約至少建立一個發票。 在某些情況下，可能會建立多個發票。

例如，如果合約有多個客戶，則會建立與在該專案合約上有計費交易要開發票之客戶同樣數目的發票。

## <a name="understand-how-transactions-are-included-on-an-invoice"></a>了解如何將交易包含在發票上 

每個專案型合約服務內容有時都會指定各自的發票排程。 例如，Adatum 合約的實作服務有下列合約服務內容：

- 包含兩個手動建立里程碑的固定價格原型工作。
- 包含時間且每兩週在星期一收費的實作工作。
- 已發生的需要在每月第一個星期一收取月費的費用。

這兩個明細項目上各自定義的發票排程看起來如下表所示：

| 合約服務內容 | 發票執行日期 | 交易截止日期 | 里程碑日期 | 里程碑金額 |
| --- | --- | --- | --- | --- |
| 原型工作 | 10 月 5 日星期一 | - | 10 月 5 日星期一 | 5000 USD |
| - | 11 月 3 日星期二 | - | 11 月 3 日星期二 | 12,000 USD |
| 實作工作 | 10 月 5 日星期一 | 10 月 4 日星期日 | - | - |
| - | 10 月 19 日星期一 | 10 月 18 日星期日 | - | - |
| - | 11 月 2 日星期一 | 11 月 1 日星期日 | - | - |
| - | 11 月 16 日星期一 | 11 月 15 日星期日 | - | - |
| 發生的費用 | 10 月 5 日星期一 | 10 月 4 日星期日 | - | - |
| - | 11 月 2 日星期一 | 11 月 1 日星期日 | - | - |

在此範例中，自動發票開立功能執行時間：

- **10 月 4 日或任何之前的日期**：不產生此合約的發票，因為這其中每一個合約服務內容的 **發票排程** 表並未報出發票執行日期為 10 月 4 日星期日。
- **10 月 5 日星期一**：已產生下列項目的發票：

    - 原型工作，包含里程碑 (如果已標示為 **已準備好開立發票**)。
    - 實作工作，包含所有在交易截止日期 10 月 4 日星期日之前建立的時間交易 (已標示為 **已準備好開立發票**)。
    - 發生的費用，包含所有在交易截止日期 10 月 4 日星期日之前建立的費用交易 (已標示為 **已準備好開立發票**)。
  
- **10 月 6 日或任何在 10 月 19 日之前的日期**：不產生此合約的發票，因為這其中每一個合約服務內容的 **發票排程** 表並未報出發票執行日期為 10 月 6 日或任何在 10 月 19 日之前的日期。
- **10 月 19 日星期一**：已為實作工作產生一個發票，此實作工作包含所有在交易截止日期 10 月 18 日星期日之前建立的時間交易 (已標示為 **已準備好開立發票**)。
- **11 月 2 日星期一**：已產生下列項目的發票：

    - 實作工作，包含所有在交易截止日期 11 月 1 日星期日之前建立的時間交易 (已標示為 **已準備好開立發票**)。
    - 發生的費用，包含所有在交易截止日期 11 月 1 日星期日之前建立的費用交易 (已標示為 **已準備好開立發票**)。

- **11 月 3 日星期二**：已為包含 12000 美元里程碑的原型工作產生一個發票 (如果已標示為 **已準備好開立發票**)。

## <a name="configure-automatic-invoicing"></a>設定自動發票開立

完成下列步驟以設定自動化發票執行。

1. 在 **Project Operations** 中，移至 **設定** > **週期性發票設定**。
2. 建立批次工作，並將其命名為 **Project Operations 建立發票**。 批次工作的名稱必須包含「建立發票」一詞。
3. 在 **工作類型** 欄位中，選取 **無**。 **每日頻率** 和 **使用中** 欄位預設會設定為 **是**。
4. 選取 **執行工作流程**。 在 **查詢記錄** 對話方塊中，您會看到三個工作流程：

- ProcessRunCaller
- ProcessRunner
- UpdateRoleUtilization

5. 選取 **ProcessRunCaller**，然後選取 **新增**。
6. 在下一個對話方塊中選取 **確定**。 **睡眠** 工作流程後面會跟著 **程序** 工作流程。 

> [!NOTE]
> 您也可以選取步驟 5 中的 **ProcessRunner**。 然後，當您選取 **確定** 時，**程序** 工作流程後面會接著 **睡眠** 工作流程。

**ProcessRunCaller** 和 **ProcessRunner** 工作流程會建立發票。 **ProcessRunCaller** 會呼叫 **ProcessRunner**。 **ProcessRunner** 是實際建立發票的工作流程。 工作流程會處理所有需要建立發票的合約服務內容，然後為這些服務內容建立發票。 為了確定必須建立其發票的合約服務內容，工作會查看合約服務內容的發票執行日期。 如果屬於一個合約的合約服務內容具有相同的發票執行日期，則會將交易合併成一個有兩個發票明細的發票。 如果沒有要要建立其發票的交易，則工作會略過建立發票。

**ProcessRunner** 執行完畢後，會呼叫 **ProcessRunCaller**、提供結束時間，然後關閉。 **ProcessRunCaller** 接著啟動計時器，從指定的結束時間開始執行 24 小時。 計時器結束時，會關閉 **ProcessRunCaller**。

用於建立發票的批次處理工作是週期性工作。 如果此批次處理已執行多次，就會建立工作的多個執行個體，並導致錯誤。 因此，您只能啟動批次處理一次，然後只在其停止執行時才重新啟動此工作。

> [!NOTE]
> 在 Project Operations 中批次開立發票，只會對發票排程所設定的專案合約服務內容來執行。 使用固定價格計費方式的合約服務內容必須已設定里程碑。 使用時間和材料計費方式的專案合約服務內容必須設定以日期為依據的發票排程。


[!INCLUDE[footer-include](../../includes/footer-banner.md)]