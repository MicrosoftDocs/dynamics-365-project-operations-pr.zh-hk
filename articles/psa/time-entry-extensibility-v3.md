---
title: 自訂每週時間項目
description: 本主題提供有關如何實作支援組織實務之自訂商務規則的資訊。
author: stsporen
ms.custom:
- dyn365-projectservice
ms.date: 07/09/2019
ms.topic: article
ms.author: rumant
audience: Admin
search.audienceType:
- admin
- customizer
- enduser
search.app:
- D365CE
- D365PS
- ProjectOperations
ms.reviewer: johnmichalak
ms.openlocfilehash: 1cc32a1d8776f4adaa0031154aba6bd6733b7f7d
ms.sourcegitcommit: c0792bd65d92db25e0e8864879a19c4b93efb10c
ms.translationtype: HT
ms.contentlocale: zh-HK
ms.lasthandoff: 04/14/2022
ms.locfileid: "8581081"
---
# <a name="customize-weekly-time-entry"></a>自訂每週時間項目 

[!include [banner](../includes/psa-now-project-operations.md)]

[!INCLUDE[cc-applies-to-psa-app-3.x](../includes/cc-applies-to-psa-app-3x.md)]

在 Microsoft Dynamics 365 Project Service Automation 3.3 版中，Microsoft 推出了新式網格，讓專案資源一次快速輸入最多一週的工時。 新的每週時間輸入網格可以依日期、列或週來顯示項目的總計。 資源可以製作一週中時間項目的複本，也可以從先前各週大量複製。 系統自訂員可以藉由新增欄位、新增查詢至其他實體，以及實作支援其組織作法的自訂商務規則，來自訂檢視表。

時間項目與新的每週時間網格是透過網站地圖進行存取。 屬於舊版 PSA 一部分的非可擴充自訂時間輸入體驗，已由可擴充的每週時間輸入網格以及唯讀網格及行事曆中的替代體驗所取代。 因為發生這項變更，使用者可以按每週金額輸入時間。

## <a name="page-layout"></a>頁面版面配置
新的每週時間輸入網格是自訂控制項，其中有一個工具列以及 **維度** 和 **期間** 這兩個主要區段。 工具列包含一個按鈕，僅適用於時間輸入網格的這個自訂控制項。 相比之下，位於頁面頂端動作窗格的按鈕適用於三種受時間項目支援的控制項類型：每週時間輸入控制項、唯讀控制項以及行事曆控制項。

### <a name="dimensions"></a>維度
**維度** 區段會以欄標題顯示所有可據以輸入時間的維度。 下列維度是現成支援的可用維度：

- 計畫
- 專案工作
- 角色
- Type
- 項目狀態

**維度** 區段不允許直接編輯。 此區段是由可讓自訂欄位新增至每週時間輸入網格的檢視表所支援。 如需如何新增自訂欄位的詳細資訊，請參閱本主題後面的「擴充性」一節。

### <a name="duration"></a>期間
[期間] 區段以欄標題顯示一週中哪幾天。 此區段允許直接編輯。 建立具有適當維度的時間項目列之後，使用者就可以直接快速輸入他們在這些維度上花費的時間量。

## <a name="create-a-new-time-entry"></a>建立新的時間項目
若要在時間輸入網格中建立新的時間項目，請選取 **新增**。  **時間項目快速建立** 對話方塊隨即出現。 在此對話方塊中，使用者可以選取時間項目日期，然後連同數字鍵入 **h**、**m** 或 **d**，以分鐘、小時或天數來輸入 **專案**、**專案工作**、**角色** 和 **期間** 維度的資料。 使用者也可以輸入時間項目可供外部共用的描述和註解。 當使用者儲存其變更時，他們依據維度輸入的值會顯示在 **維度** 區段中。 他們在 **期間** 欄位中輸入的期間資訊會在建立時間項目的日期出現。

系統檢視表支援查詢欄位。 例如，使用者進入專案後，**專案工作** 欄位預設會設定為 **複製** 檢視表。 若要建立未指派給使用者之工作的時間項目，請在查詢對話方塊中選取 **變更檢視表**，然後選取 **所有使用中專案工作** 檢視表。

## <a name="edit-a-time-entry"></a>編輯時間項目
時間項目頁面上某些欄位的詳細資料 (例如 **描述** 和 **外部註解**) 不會顯示在每週時間輸入網格中。 相反的，會有一個小三角形指標出現在含有這些額外詳細資料的期間儲存格中。 選取儲存格，然後選取 **編輯詳細資料**，以在 **快速編輯** 窗格中檢視資料。 若要針對不屬於每週時間輸入網格一部分的特定時間項目來編輯或更新其詳細資料，則使用者必須開啟 **快速編輯** 窗格。

## <a name="copy-a-time-entry-row"></a>複製時間項目列
建立第一個時間項目列之後，使用者可以選取 **複製列**，將整列複製到新的一列。 以這種方式複製一列時，也會複製維度和期間。 使用者也可以選取 **編輯列**，更新維度值並直接在 **期間** 區段中編輯期間。

## <a name="open-a-time-entry"></a>開啟時間項目
為了在最顯著的欄位中支援最佳且快速輸入，每週時間輸入網格會顯示所選維度及時間期間的子集。 若要檢視單一時間項目的所有詳細資料，請在 **編輯專案** 下選取 **開啟**。

## <a name="submit-a-time-entry"></a>送出時間項目
使用者可以送出單一時間項目或一組時間項目，方法是選取儲存格區塊或整個時間項目列，然後選取 **送出**。 送出的時間項目會在核准者的 **核准** 頁面上顯示為等待核准。 成功送出時間項目之後，就無法加以編輯。

## <a name="recall-a-time-entry"></a>回收時間項目
您可以回收已送出的時間項目。 您可以回收單一時間項目、時間項目區塊或整列時間項目。 回收的時間項目可供資源進行編輯。

## <a name="time-entry-status"></a>時間項目狀態
系統會自動為新的時間項目指派 **草稿** 狀態。 送出時間項目時，狀態會更新為 **已送出**。 送出的時間項目獲核准時，狀態會更新為 **已核准**。 如果時間項目遭拒絕，狀態會更新為 **已退回**，而項目會變成可供更正並重新送出。 只有狀態為 **草稿** 的時間項目可以被刪除。

## <a name="view-rejection-comments"></a>檢視拒絕註解
核准者拒絕時間項目時，該核准人可能會加入拒絕註解，幫助資源了解拒絕原因。 若要檢視時間項目的拒絕註解，請選取 **開啟專案**。 這些拒絕註解會顯示在時間表中。 在時間表中，資源可在重新送出項目之前，先回應拒絕註解。

## <a name="copy-week"></a>複製週次
建立幾個時間項目之後，使用者可以選取 **複製週次** 大量建立其他時間項目。 **複製** 對話方塊隨即顯示。 在 **開始期間** 區段中，使用 **開始日期** 和 **結束日期** 欄位來定義要從中複製時間項目的日期範圍。 在 **結束期間** 區段的 **開始日期** 欄位中，指定建立時間項目的日期。 然後選取 **複製**。 對於「結束」期間的指定日期，會建立「開始」期間中對應星期幾的時間項目複本。 例如，將上週星期一的時間項目複製到指定為「結束」期間的週的星期一。

## <a name="import"></a>匯入
您可以使用相同的基本程序，從預約、指派和交換中匯入。 使用者可以指定要從中匯入預約的日期範圍。 他們接著必須明確選取應複製成草稿時間項目的預約。 在先前版本中，建議的時間項目會出現在網格和行事曆中，並在重新整理工作階段時遺失。

## <a name="extensibility"></a>擴充性
### <a name="add-custom-fields-that-have-lookups-to-other-entities"></a>新增具有其他實體查詢的自訂欄位
有三個主要步驟將自訂欄位新增至每週時間輸入網格。

1.  將自訂欄位新增至 [快速建立] 對話方塊。
2.  設定網格以顯示自訂欄位。
3.  視需要將自訂欄位新增至列編輯工作流程或儲存格編輯工作流程。

您也必須確定新欄位在列或儲存格編輯工作流程中有必要的驗證。 在此步驟中，您必須根據時間項目狀態鎖定欄位。

#### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a>將自訂欄位新增至 [快速建立] 對話方塊
您必須將自訂欄位新增至 [時間項目快速建立] 對話方塊。 因此該使用者可以在使用 **新增** 按鈕新增時間專案時輸入其值。

#### <a name="configure-the-grid-to-show-the-custom-field"></a>設定網格以顯示自訂欄位
有兩個方法將自訂欄位新增至每週時間輸入網格。 第一個選項是自訂 **我的每週時間項目** 檢視表，並將自訂欄位新增至其中。 您可以在檢視表中編輯這些屬性，以選擇網格中自訂欄位的位置和大小。

第二個選項是建立新的自訂時間輸入檢視表，並將其設定為預設檢視表。 除了您要包含在網格中的欄之外，此檢視表應也包含 **描述** 及 **外部註解** 欄位。 您可以在檢視表中編輯這些屬性，以選擇網格的位置、大小和預設排序順序。 接下來，設定此檢視表的自訂控制項，使其成為 **時間輸入網格** 控制項。 將此控制項新增至檢視表，然後選取該控制項以用於網頁、手機及平板電腦。 接下來，設定每週時間輸入網格的參數。 將 **開始日期** 欄位設定為 **msdyn_date**、將 **期間** 欄位設定為 **msdyn_duration**，以及並將 **狀態** 欄位設定為 **msdyn_entrystatus**。 在預設檢視表中，**唯讀狀態清單** 欄位設定為 **192350002,192350003,192350004**、**列編輯工作流程** 欄位設定為 **msdyn_timeentryrowedit**，以及 **儲存格編輯工作流程** 欄位已設定為 **msdyn_timeentryedit**。 您可以自訂這些欄位以新增或移除唯讀狀態，或是使用不同的工作型體驗 (TBX) 進行列或儲存格編輯。 這些欄位應繫結至靜態值。

#### <a name="add-the-custom-field-to-the-appropriate-edit-task-flow"></a>將自訂欄位新增至適當的編輯工作流程
您可以在 **程序** 底下找到用於編輯的 TBX 頁面。 預設頁面是 **Project Service - 時間項目列編輯** 和 **Project Service - 時間項目編輯**。 您可以編輯這些預設頁面，或建立新的自訂 TBX 頁面。

> [!NOTE] 
> 這兩個選項都會移除 **專案** 與 **專案工作** 實體的一些預設的篩選，讓實體的所有查詢檢視表都能看得到。 在預設情況下，只會顯示相關的查詢檢視表。

您必須為自訂欄位判斷適當的工作流程。 最可能的一點是，如果您將欄位新增至網格，則該欄位應該會移至用於套用至整列時間項目之欄位的列編輯工作流程。 如果自訂欄位每天都會有唯一值 (例如 **結束時間** 的自訂欄位)，則應進入儲存格編輯工作流程。

若要將自訂欄位新增至工作流程，請將 **欄位** 元素拖曳至頁面的適當位置，然後設定其屬性。 將 **來源** 屬性設定為 **時間項目**，並將 **資料欄位** 屬性設定為自訂欄位。 **欄位** 屬性會指定在 TBX 頁面上的顯示名稱。 選取 **套用** 以儲存對欄位的變更。 然後選取 **更新** 以儲存您對頁面的變更。

若要改用新的自訂 TBX 頁面，請建立新的程序。 將類別設定為 **商務程序流程**、將實體設定為 **時間項目**，以及將商務程序類型設定為 **以工作流程方式執行程序**。 在 **屬性** 底下，**頁面名稱** 屬性應設定為頁面的顯示名稱。 將所有相關欄位新增至 TBX 頁面。 儲存並啟用程序，然後將相關工作流程的自訂控制項屬性更新為程序中的 **名稱** 值。

### <a name="add-new-option-set-values"></a>新增選項組值
若要將選項組值新增至現成可用欄位，請開啟欄位的編輯頁面，然後在 **類型** 底下選取選項組旁邊的 **編輯**。 接下來，新增具有自訂標籤與色彩的新選項。 如果您想要加入新的時間項目狀態，請將現成可用欄位命名為 **項目狀態**，而不是 **狀態**。

### <a name="designate-a-new-time-entry-status-as-read-only"></a>將新的時間項目狀態指定為唯讀
若要將新的時間項目狀態指定為唯讀，請將新的時間項目值 (數字，而不是標籤) 新增至 **唯讀狀態清單** 屬性。 將會針對有新狀態的列，鎖定其時間輸入網格的可編輯部分。
接下來，新增商務規則以鎖定 **時間項目列編輯** 和 **時間項目編輯** TBX 頁面上的所有欄位。 您可以開啟頁面的商務程序流程編輯器，然後選取 **商務規則** 來存取這些頁面的商務規則。 您可以將新狀態新增至現有商務規則中的條件，也可以為新狀態新增商務規則。

### <a name="add-custom-validation-rules"></a>新增自訂驗證規則
您可以為每週時間輸入網格體驗新增的驗證規則有兩種類型：• 用戶端商務規則 (可在快速建立對話方塊和 TBX 頁面上使用)，• 伺服器端外掛程式驗證 (適用於所有時間項目更新)

#### <a name="business-rules"></a>商務規則
使用商務規則鎖定和解除鎖定欄位、在欄位中輸入預設值，然後定義驗證，要求資訊只能來自目前時間項目記錄。 您可以開啟 TBX 頁面的商務程序流程編輯器，然後選取 **商務規則** 來存取此頁面的商務規則。 您可以接著編輯現有的商務規則，或新增商務規則。 如果還要更多的自訂驗證，您可以使用商務規則來執行 JavaScript。

#### <a name="plug-in-validations"></a>外掛程式驗證
對於任何需要內容超過單一時間項目記錄所能提供範圍的驗證，或是對於任何要在網格中對內嵌更新執行的驗證，您應該使用外掛程式驗證。 若要完成驗證，請在 **時間項目** 實體上建立自訂外掛程式。

> [!IMPORTANT] 
> 目前，當更新未通過外掛程式驗證時，TBX 頁面會發生一個已知的問題，造成使用者無法更正資訊和重新選取 [完成]。 如需採取因應措施，請設定商務規則驗證，盡可能避免發生這種情況。


[!INCLUDE[footer-include](../includes/footer-banner.md)]
