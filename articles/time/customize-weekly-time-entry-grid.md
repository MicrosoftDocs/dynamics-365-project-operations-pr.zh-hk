---
title: 擴充時間項目
description: 本主題提供有關開發人員如何擴充時間項目控制項的資訊。
author: stsporen
manager: Annbe
ms.date: 10/08/2020
ms.topic: article
ms.service: project-operations
ms.reviewer: kfend
ms.author: stsporen
ms.openlocfilehash: d9c14f0550d4429ac794607a3fb61717566207e4
ms.sourcegitcommit: 4cf1dc1561b92fca4175f0b3813133c5e63ce8e6
ms.translationtype: HT
ms.contentlocale: zh-HK
ms.lasthandoff: 10/28/2020
ms.locfileid: "4124665"
---
# <a name="extending-time-entries"></a>擴充時間項目

_**適用於：** 資源/非庫存型案例適用的 Project Operations、精簡部署 - 交易至開立預估發票_

Dynamics 365 Project Operations 包含可擴充的時間項目自訂控制項。 此控制項包含下列功能：

- 輸入橫跨一週的時間
- 依日、列或週的總計
- 複製列或週
- 透過 HH:mm 或 HH.hh (自動轉換為 HH.hh) 輸入的時間項目
- 從指派、預約或約會匯入

時間項目可在兩個區域中進行擴充：
- [新增自訂時間項目供自己使用](#add)
- [自訂每週時間項目控制項](#customize)

## <a name="add-custom-time-entries-for-your-own-use"></a><a name="add"></a>新增自訂時間項目供自己使用

時間項目是多個案例中所使用的核心實體。 在 2020 年 4 月第 1 段浪潮中，推出了 TESA 核心解決方案。 TESA 提供 **設定** 實體以及新的 **時間項目使用者** 資訊安全角色。 其中也包含與 **msdyn_duration** 有直接關聯的新欄位 **msdyn_start** 和 **msdyn_end**。 新的實體、資訊安全角色及欄位讓您有更統一的方法可以跨多個產品處理時間。


### <a name="time-source-entity"></a>時間來源實體
| 欄位 | 描述 | 
|-------|------------|
| 名字  | 時間來源實體的名稱會在建立時間項目時用來做為選取值。 |
| 預設時間來源 [時間來源：isdefault] | 根據預設，能以預設標示的僅限一個時間來源。 這允許項目預設為時間來源 (如果未指定的話)。 |
|時間來源類型 [時間來源：sourcetype] | 來源類型是允許將時間來源關聯至應用程式的選項 (時間項目來源類型)。 Microsoft 會保留大於 190,000,000 的值。|


### <a name="time-entries-and-the-time-source-entity"></a>時間項目和時間來源實體
每個時間項目都會與時間來源記錄建立關聯。 此記錄可決定應用程式應如何處理時間項目以及應由哪些應用程式來處理。

時間項目永遠都是一個已連結開始、結束及期間的時間連續區塊。

邏輯會自動在下列情況中更新時間項目記錄：

- 如果提供下列三個欄位中的兩個，則會自動計算第三個欄位： 

    - **msdyn_start**
    - **msdyn_end**
    - **msdyn_duration**

- 欄位 **msdyn_start** 和 **msdyn_end** 是時區感知欄位。
- 僅使用指定的 **msdyn_date** 和 **msdyn_duration** 所建立的時間項目將會從午夜開始。 **msdyn_start** 和 **msdyn_end** 欄位也會相應更新。

#### <a name="time-entry-types"></a>時間項目類型

時間項目記錄的關聯類型會定義相關聯應用程式在提交流程中的行為。

|標籤 | 值|
|-----|-----|
|休息   |192,355,000|
|差旅 | 192,355,001|
|加班時間   | 192,354,320|
|工作   | 192,350,000|
|缺席    | 192,350,001|
|休假   | 192,350,002|



## <a name="customize-the-weekly-time-entry-control"></a><a name="customize"></a>自訂每週時間項目控制項
開發人員可以將額外的欄位和查詢新增至其他實體，並實作自訂商務規則以支援其業務案例。

### <a name="add-custom-fields-with-lookups-to-other-entities"></a>新增具有其他實體查詢的自訂欄位
有三個主要步驟將自訂欄位新增至每週時間輸入網格。

1. 將自訂欄位新增至 [快速建立] 對話方塊。
2. 設定網格以顯示自訂欄位。
3. 將自訂欄位新增至列編輯工作流程或儲存格編輯工作流程。

請確定新欄位在列或儲存格編輯工作流程中有必要的驗證。 在此步驟中，請根據時間項目狀態鎖定欄位。

### <a name="add-the-custom-field-to-the-quick-create-dialog-box"></a>將自訂欄位新增至 [快速建立] 對話方塊
將自訂欄位新增至 **時間項目快速建立** 對話方塊。 然後在新增時間項目時，就可以選取 **新增** 來輸入值。

### <a name="configure-the-grid-to-show-the-custom-field"></a>設定網格以顯示自訂欄位
有兩個方法可以將自訂欄位新增至每週時間輸入網格：

  - 自訂檢視表並新增自訂欄位
  - 建立新的預設自訂時間項目 


#### <a name="customize-a-view-and-add-a-custom-field"></a>自訂檢視表並新增自訂欄位

自訂 **我的每週時間項目** 檢視表，並將自訂欄位新增至其中。 您可以編輯檢視表中的屬性，以選擇網格中自訂欄位的位置和大小。

#### <a name="create-a-new-default-custom-time-entry"></a>建立新的預設自訂時間項目

除了您要包含在網格中的欄之外，此檢視表應也包含 **描述** 及 **外部註解** 欄位。 

1. 在檢視表中編輯這些屬性，以選擇網格的位置、大小和預設排序順序。 
2. 設定此檢視表的自訂控制項，使其成為 **時間項目網格** 控制項。 
3. 將此控制項新增至檢視表，然後選取該控制項以用於網頁、手機及平板電腦。 
4. 設定每週時間項目網格的參數。 
5. 將 **開始日期** 欄位設定為 **msdyn_date**、將 **期間** 欄位設定為 **msdyn_duration**，以及並將 **狀態** 欄位設定為 **msdyn_entrystatus**。 
6. 在預設檢視表中，**唯讀狀態清單** 欄位會設定為 **192350002,192350003,192350004**。 **列編輯工作流程** 欄位設定為 **msdyn_timeentryrowedit**。 **儲存格編輯工作流程** 欄位設定為 **msdyn_timeentryedit**。 
7. 您可以自訂這些欄位以新增或移除唯讀狀態，或是使用不同的工作型體驗 (TBX) 進行列或儲存格編輯。 這些欄位現已繫結至靜態值。


> [!NOTE] 
> 這兩個選項都會移除 **專案** 與 **專案工作** 實體的一些現成可用篩選，讓實體的所有查詢檢視表都能看得到。 在預設情況下，只會顯示相關的查詢檢視表。

判斷自訂欄位適用的工作流程。 如果您將欄位新增至網格，則該欄位應該會移至用於套用至整列時間項目之欄位的列編輯工作流程。 如果自訂欄位每天都會有唯一值 (例如 **結束時間** 的自訂欄位)，則應進入儲存格編輯工作流程。

若要將自訂欄位新增至工作流程，請將 **欄位** 元素拖曳至頁面的適當位置，然後設定欄位屬性。 將 **來源** 屬性設定為 **時間項目**，並將 **資料欄位** 屬性設定為自訂欄位。 **欄位** 屬性會指定在 TBX 頁面上的顯示名稱。 選取 **套用** 儲存對欄位的變更，然後選取 **更新** 以儲存對頁面的變更。

若要改用新的自訂 TBX 頁面，請建立新的程序。 將類別設定為 **商務程序流程**、將實體設定為 **時間項目**，以及將商務程序類型設定為 **以工作流程方式執行程序**。 在 **屬性** 底下，**頁面名稱** 屬性應設定為頁面的顯示名稱。 將所有相關欄位新增至 TBX 頁面。 儲存並啟用此程序。 將相關工作流程的自訂控制項屬性更新為程序中的 **名稱** 值。

### <a name="add-new-option-set-values"></a>新增選項組值
若要將選項組值新增至現成可用欄位，請開啟欄位的編輯頁面，然後在 **類型** 底下選取選項組旁邊的 **編輯**。 新增具有自訂標籤與色彩的新選項。 如果您想要加入新的時間項目狀態，請將現成可用欄位命名為 **項目狀態**，而不是 **狀態**。

### <a name="designate-a-new-time-entry-status-as-read-only"></a>將新的時間項目狀態指定為唯讀
若要將新的時間項目狀態指定為唯讀，請將新的時間項目值新增至 **唯讀狀態清單** 屬性。 將會針對有新狀態的列，鎖定其時間輸入網格的可編輯部分。
接下來，新增商務規則以鎖定 **時間項目列編輯** 和 **時間項目編輯** TBX 頁面上的所有欄位。 您可以開啟頁面的商務程序流程編輯器，然後選取 **商務規則** 來存取這些頁面的商務規則。 您可以將新狀態新增至現有商務規則中的條件，也可以為新狀態新增商務規則。

### <a name="add-custom-validation-rules"></a>新增自訂驗證規則
您有兩個可以為每週時間項目網格體驗新增的驗證規則類型：

- 可在快速建立對話方塊和 TBX 頁面上使用的用戶端商務規則。
- 適用於所有時間項目更新的伺服器端外掛程式驗證。

#### <a name="business-rules"></a>商務規則
使用商務規則鎖定和解除鎖定欄位、在欄位中輸入預設值，然後定義驗證，要求資訊只能來自目前時間項目記錄。 您可以開啟 TBX 頁面的商務程序流程編輯器，然後選取 **商務規則** 來存取此頁面的商務規則。 您可以接著編輯現有的商務規則，或新增商務規則。 如果還要更多的自訂驗證，您可以使用商務規則來執行 JavaScript。

#### <a name="plug-in-validations"></a>外掛程式驗證
對於任何需要內容超過單一時間項目記錄所能提供範圍的驗證，或是對於任何要在網格中對內嵌更新執行的驗證，請使用外掛程式驗證。 若要完成驗證，請在 **時間項目** 實體上建立自訂外掛程式。

### <a name="copying-time-entries"></a>複製時間項目
使用 **複製時間項目欄** 檢視表來定義要在時間輸入期間複製的欄位清單。 **日期** 和 **期間** 是必要欄位，不可從檢視表移除。


[!INCLUDE[footer-include](../includes/footer-banner.md)]